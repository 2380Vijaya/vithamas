#include <stdio.h>
#include <stdlib.h>

unsigned char* extractPayload(const unsigned char* input_array, int* payload_length) {
    if (input_array == NULL || input_array[0] == 0 || input_array[1] == 0) {
        printf("Invalid input data\n");
        return NULL;
    }

    int length = input_array[1] * 256 + input_array[2];

    if (length <= 1 || length > 255) {
        printf("Invalid length\n");
        return NULL;
    }

    unsigned char data_type = input_array[3];

    int payload_start_index = 4;

    unsigned char* payload = (unsigned char*)malloc((length - 1) * sizeof(unsigned char));

    for (int i = 0; i < length - 1; ++i) {
        payload[i] = input_array[payload_start_index + i];
    }

    *payload_length = length - 1;

    return payload;
}

int main() {
    // Hardcoded input data in decimal format
    unsigned char input_array[] = {0, 2, 0, 17, 1, 1, 2, 3, 4, 5, 6, 7, 8, 9, 16};

    int payload_length;
    unsigned char* payload = extractPayload(input_array, &payload_length);

    if (payload != NULL) {
        printf("Payload Data: ");
        for (int i = 0; i < payload_length; ++i) {
            printf("%d ", payload[i]);
        }
        printf("\n");

        free(payload);
    }

    return 0;
}
